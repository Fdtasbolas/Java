<!DOCTYPE HTML>
<html>
<head>
<title>GarageOpener</title>
<script type="text/javascript" charset="utf-8" src="cordova-2.1.0.js"></script>
<script src="./scripts/jquery-1.8.2.min.js"></script>
<!--<script src="http://debug.phonegap.com/target/target-script-min.js#champsterino"></script>-->
<script type="text/javascript">
	var sensorInterval;

	document.addEventListener("deviceready",onDeviceReady,false);
		
	function onDeviceReady() {  
		sensorInterval = setInterval(getGarageStatus, 10000);
		document.addEventListener("pause", function(){ clearInterval(sensorInterval); }, false);
		document.addEventListener("resume", function(){ sensorInterval = setInterval(getGarageStatus, 10000); }, false);
	}
	
	$(document).ready(function() {
	    getGarageStatus();
	});
			
	function getGarageStatus(){
		 console.log('retrieving garage status');
		 var url = 'http://home.hysonix.com?status';
		 $.ajaxSetup({
		    cache: false
		 });
		 $.getJSON(url, null, function(data, textStatus, jqXHR) {
	        var doorStatus = data;
	        console.log(data);
	        if(doorStatus.Door1.indexOf('Open') > -1) {
	        	$('.door1').css('background-color', 'red');
        	}
        	else{
	        	$('.door1').css('background-color', 'green');        	
        	}
        	
	        if(doorStatus.Door2.indexOf('Open') > -1) {
	        	$('.door2').css('background-color', 'red');
        	}
        	else{
	        	$('.door2').css('background-color', 'green');        	
        	}
	    });
	}

	function openGarage(door) {
		var url = 'http://home.hysonix.com?door=' + door.toString();
		 $.getJSON(url, null, function(data) {
	        console.log(data);
	    });
	}
	
</script>
</head>
<body >
<div style="width:300px; height: 400px; background-color: #000; -moz-border-radius: 15px; border-radius: 15px;">
	<div class="door1" onclick="openGarage(1);" style="cursor: pointer; margin-left: 12px; margin-top: 10px; float: left; width: 132px; height: 200px; background-color: #CCC; font-size: 48pt; text-align: center; -moz-border-radius: 5px; border-radius: 5px; font-family: arial">I</div>
	<div class="door2" onclick="openGarage(2);" style="cursor: pointer; margin-left: 12px; margin-top: 10px; float: left; width: 132px; height: 200px; background-color: #CCC; font-size: 48pt; text-align: center; -moz-border-radius: 5px; border-radius: 5px; font-family: arial">II</div>
</div>
</body>

</html>
